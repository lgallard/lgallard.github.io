<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.6.0 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>OctoPrint with multiple 3D printers - lgallardo.com</title>




<meta name="description" content="">




<meta name="author" content="Luis Gallardo">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="lgallardo.com">
<meta property="og:title" content="OctoPrint with multiple 3D printers">


  <link rel="canonical" href="https://lgallardo.com/2022/09/25/octoprint-multiple-printers">
  <meta property="og:url" content="https://lgallardo.com/2022/09/25/octoprint-multiple-printers">



  <meta property="og:description" content="">



  <meta name="twitter:site" content="@lgallard">
  <meta name="twitter:title" content="OctoPrint with multiple 3D printers">
  <meta name="twitter:description" content="">
  <meta name="twitter:url" content="https://lgallardo.com/2022/09/25/octoprint-multiple-printers">

  
    <meta name="twitter:card" content="summary">
    
  

  
    <meta name="twitter:creator" content="@Luis Gallardo">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-09-24T19:00:00-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Luis M. Gallardo D.",
      "url" : "https://lgallardo.com",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->

<link href="https://lgallardo.com/feed.xml" type="application/atom+xml" rel="alternate" title="lgallardo.com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://lgallardo.com/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->




    <!-- start custom head snippets -->
<!-- 
  
  <a href="/es/2022/09/25/octoprint-multiple-printers" >Español</a>

-->
<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="https://lgallardo.com/">lgallardo.com</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="https://lgallardo.com/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://lgallardo.com/tags/">Tags</a></li>
          
          
            
            <a href="/es/2022/09/25/octoprint-multiple-printers" >Español</a>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>



    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://lgallardo.com/assets/images/luis.jpg" class="author__avatar" alt="Luis M. Gallardo D." itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Luis M. Gallardo D.</h3>
    
      <p class="author__bio" itemprop="description">
        
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Buenos Aires, Argentina</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://twitter.com/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      
        <li>
          <a href="https://www.stackoverflow.com/users/3229508/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-stack-overflow" aria-hidden="true"></i> Stackoverflow
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="OctoPrint with multiple 3D printers">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="September 25, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">OctoPrint with multiple 3D printers
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  14 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p><img src="/assets/images/OctoPrint.jpg" alt="OctoPrints" style="display:block; margin-left:auto; margin-right:auto" /><br /></p>

<p>One of the most useful tools when managing a 3D printer is <a href="https://octoprint.org" target="_blank">OctoPrint</a>, since among several things it allows you to manage your printer from a web interface, as well as adding a lot of functionality (for example, monitoring and management of the printer through Telegram, plugins to generate timelapse videos of the prints, or even detect when there are spaghetti-like problems in our prints using another plugin with AI).</p>

<h2 id="multiple-printers">Multiple printers</h2>

<p>But what if we have more than one printer? Can <strong>OctoPrint</strong> manage more than one printer?</p>

<p>The short answer is: NO! The software itself is not designed for multiple printers, but you can find alternative ways to have more than one instance of <strong>OctoPrint</strong> running on your device or computer.</p>

<p>There are several ways to do this, for example you can <a href="http://thomas-messmer.com/index.php/14-free-knowledge/howtos/79-setting-up- octoprint-for-multiple-printers" target="_blank">modify the OctoPi scripts to add more instances</a>, create scripts that launch multiple instances of the same program, but the option I ended up using was Docker containers.</p>

<h2 id="raspberry-pi--ubuntu">Raspberry Pi + Ubuntu</h2>

<p>In my case I have a <strong>Raspberry Pi 4</strong>, with 8 GB of RAM, more than enough to run multiple instances of <strong>OctoPrint</strong>.</p>

<p>I originally had a specific operating system installed on my Raspberry called <a href="https://github.com/guysoft/OctoPi">OctoPi</a>, a Debian derivative with <strong>OctoPrint</strong> as the main program that is launched when the Raspberry Pi is turned on, but as I wanted to use containers I decided to use Ubuntu, which general purposed distribution where you can surely find everything you need to work with containers.</p>

<h2 id="requirements-and-components">Requirements and components:</h2>

<p>For this setup I used the following:</p>

<ul>
  <li>Impresora 3D - Artillery Genius Pro</li>
  <li>Impresora 3D - Artillery SideWinder X2</li>
  <li>2x WebCam - Logitech C270 (one per printer)</li>
  <li>Raspberry Pi 4 - 8G RAM</li>
  <li>SD Card 64 GB</li>
  <li>Ubuntu 22.04 LTS  ARM 64 bits</li>
  <li>Docker 20.10.17</li>
  <li>OctoPrint lastest (1.8.3)</li>
</ul>

<h2 id="ubuntu-installation">Ubuntu Installation</h2>

<p>Nowadays is easier than ever to install <strong>Ubuntu</strong> on the Raspberry Pi, you just have to download <strong>Raspberry Pi Imager,</strong> which will generate the image on your SD card, select the operating system, which in this case is <strong>Ubuntu 22.04 LTS</strong> and you’re done.  <strong>Raspberry Pi Imager</strong> is avialable for Linux, Mac and Windows, so you can generate the image on the operating system that suits you best.</p>

<p><img src="/assets/images/Raspberry-Pi-Imager.jpg" alt="Raspberry Pi Imager" />
{:style=”display:block; margin-left:auto; margin-right:auto”}<br /></p>

<p>From this very software you will have the possibility to configure the password of the WiFi network in case you are using the Raspberry wirelessly, so you don’t need  to use a television set and a keyboard (headless), or manipulate the SD card to configure the networking. Since I’m using it headless, that’s what I did and then I connected via <strong>ssh</strong>.</p>

<p><img src="assets/images/OctoPi-WiFi-Setting.jpg" alt="WiFi Settings" /></p>

<p>For the headless setup the trick is to let the <strong>Ubuntu</strong> initialization scripts run and then connect via ssh. Now if you see that you can’t connect via ssh you can look for an HDMI cable and a keyboard to check what might be going on.</p>

<h2 id="software-installation-on-ubuntu">Software installation on Ubuntu</h2>

<p>Apart from <strong>Docker</strong> we are going to need <strong>docker-compose</strong>, and the utilities that will help us install them.</p>

<h2 id="docker-and-docker-compose">Docker and docker-compose</h2>

<p>To install docker you need to download it using the script. You will need to loging in as the administrator user with the root account:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi@octopi:~<span class="nv">$ </span><span class="nb">sudo </span>su
root@octopi:~# 

root@octopi:~# apt install curl
root@octopi:~# curl <span class="nt">-sSL</span> https://get.docker.com | sh

root@octopi:~# apt update
root@octopi:~# apt install docker-compose
</code></pre></div></div>

<h2 id="octoprint-with-one-printer">Octoprint with one printer</h2>

<p>The first thing you need is to create a folder for OctoPrint, and then go into it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~# mkdir octoprint
root@octopi:~# 
root@octopi:~# <span class="nb">cd </span>octoprint/
root@octopi:~/octoprint#
</code></pre></div></div>

<p>Let’s start with a printer, in this case I’ll start with the <code class="highlighter-rouge">Artillery Genius Pro</code>. For this you can create a folder that identifies this printer:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~# mkdir geniuspro
root@octopi:~# chmod <span class="nt">-R</span> 777 geniuspro/
</code></pre></div></div>

<p>It’s important to know the actual path because you’ll use it later in the container definition along with the name of this folder. To do this, execute the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~# <span class="nb">pwd</span>
/root/octoprint
</code></pre></div></div>

<p>With this you can indicate the files of this first instance of OctoPrint will reside in <code class="highlighter-rouge">/root/octoprint/geniuspro</code></p>

<p>Now to configure the printer you need to use  <code class="highlighter-rouge">docker-compose</code> so you need to create the <code class="highlighter-rouge">docker-compose.yml</code> file with the following information:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyACM0:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/video0:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30
</code></pre></div></div>

<p>This file defines various things related to OctoPrint, such as the webcam and the printer itself. For example,  <code class="highlighter-rouge">image</code>  indicates which Docker image to use for the <code class="highlighter-rouge">geniuspro</code> service.</p>

<p>Notice the ports definitions, where <code class="highlighter-rouge">5000</code> will be used for the web interface and <code class="highlighter-rouge">8080</code> for webcam streaming video.</p>

<p>On the other hand, the printer is defined as a device in <code class="highlighter-rouge">/dev/ttyACM0</code>, and the webcam in <code class="highlighter-rouge">/dev/video0</code></p>

<p>Something to keep in mind and that differs from the <a href="https://docs.google.com/document/d/1aU7LGYAe6r45LqEBQ8opuXCiNKeJl3XrPTrobvEvdOM/edit" target="_bla￼nk">example on which I based</a>, is that the streamer is now part of the Docker image and is served on port <code class="highlighter-rouge">8080</code>, so there is no need to have a separate definition of another Docker image pointing to the streamer.</p>

<p><code class="highlighter-rouge">volumes</code>  has the reference to the printer directory that you had created as <code class="highlighter-rouge">/root/octoprint/geniuspro</code>, which will be mapped into the container as the <code class="highlighter-rouge">/octoprint</code> folder. That is, when we launch the container all the OctoPrint files for this printer will be in the <code class="highlighter-rouge">/root/octoprint/geniuspro</code> path of the operating system.</p>

<p>Finally, <code class="highlighter-rouge">environment</code> has the streamer parameters, like webcam device from the container. In this case both the OS and the container match the path <code class="highlighter-rouge">/dev/video0</code>. Here you also need to provide you webcam parameters, in my case I indicated that the resolution is 1280x960 at 30 frames per second, which is what corresponds to my Logitech C270. For other models you can consult the <a href="https://community.octoprint.org/t/usb-webcams-known-to-work-with-mjpg-streamer/21149">supported cameras list page</a>.</p>

<p>Once the <code class="highlighter-rouge">docker-compose.yaml</code> file has been created with the information shown above, all you have to do is start the service with Docker:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# docker-compose up -d
  
Creating octoprint_geniuspro_1 ... done
</code></pre></div></div>

<p>With this we can access the OctoPrint web interface from the Raspberry Pi on the port that we had indicated,  in my case the url is http://192.168.68.102:5000:</p>

<p><img src="assets/images/octoprint-multi-web.jpg" alt="Image" /></p>

<h2 id="adding-a-second-printer">Adding a second printer</h2>

<p>To add a second printer, you just have to replicate the configuration you had before, but specifying the new printer and the corresponding video camera. So for my Artillery Sidewinder X2 this would be:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyACM0:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/video0:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30
 
  sidewinder_x2:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyACM1:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/video2:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30

</code></pre></div></div>

<p>Take into account the phycal printer is identified as <code class="highlighter-rouge">/dev/ttyACM1</code> in the Raspberry , but the container internally it will be see it as <code class="highlighter-rouge">/dev/ttyACM0</code>. The same goes for the video camera, where it is physically identified as <code class="highlighter-rouge">/dev/video2</code> but internally the container will see it as <code class="highlighter-rouge">/dev/video0</code>.</p>

<p>Once the configuration has been created, the container must be run as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# docker-compose up -d
  
octoprint_geniuspro_1 is up-to-date
Creating octoprint_sidewinderx2_1 ... done
</code></pre></div></div>

<p>This will now allow access to the second instance of OctoPrint on port 5001:</p>

<p><img src="assets/images/octoprint-multi-web2.png" alt="Image" /></p>

<h2 id="how-to-differentiate-printers">How to differentiate printers?</h2>

<p>In the example above I used the devices <code class="highlighter-rouge">/dev/ttyACM0</code> and <code class="highlighter-rouge">/dev/ttyACM1</code> to reference my first printer, the Artillery Genius Pro, and my second printer, the Artillery SideWinder X2, but the operating system not always takes that order, since it will depend on which one you had turned on first. In order to identify the printers regardless of the connection order we can create a symbolic link using <code class="highlighter-rouge">udev</code> with the manufacturer and product information.</p>

<p>For this, you have first list the USB devices:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# lsusb
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 004: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 003: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 015: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 016: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 002: ID 2109:3431 VIA Labs, Inc. Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre></div></div>

<p>There are two <strong>STMicroelectronics Virtual COM Port</strong> devices here, corresponding to the two printers, but which is which? We are going to ask for the detail of these devices:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@octopi:~/octoprint# lsusb -v -d 0483:5740

Bus 001 Device 015: ID 0483:5740 STMicroelectronics Virtual COM Port
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            2 Communications
  bDeviceSubClass         2 Abstract (modem)
  bDeviceProtocol         0
  bMaxPacketSize0        64
  idVendor           0x0483 STMicroelectronics
  idProduct          0x5740 Virtual COM Port
  bcdDevice            0.00
  iManufacturer           1 STMicroelectronics
  iProduct                2 ARTILLERY_RUBY CDC in FS Mode
  iSerial                 3 386F39543538  
...
  
Bus 001 Device 016: ID 0483:5740 STMicroelectronics Virtual COM Port
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            2 Communications
  bDeviceSubClass         2 Abstract (modem)
  bDeviceProtocol         0
  bMaxPacketSize0        64
  idVendor           0x0483 STMicroelectronics
  idProduct          0x5740 Virtual COM Port
  bcdDevice            0.00
  iManufacturer           1 STMicroelectronics
  iProduct                2 ARTILLERY_RUBY CDC in FS Mode
  iSerial                 3 3594398F3538  
...
</code></pre></div></div>

<p>What differentiates one printer from another is the serial number of the device. Since the Artillery Genius Pro was initially mapped to <code class="highlighter-rouge">/dev/ttyACM0</code>, we can check what its serial number is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm info -a -n /dev/ttyACM0 | grep serial
    ATTRS{serial}=="3594398F3538"
    ATTRS{serial}=="0000:01:00.0"
</code></pre></div></div>

<p>Now to see the serial code of the Artillery Sidewinder X2 you have to consult the device <code class="highlighter-rouge">/dev/ttyACM1</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
root@octopi:~/octoprint# udevadm info -a -n /dev/ttyACM1 | grep serial
    ATTRS{serial}=="386F39543538"
    ATTRS{serial}=="0000:01:00.0" 
</code></pre></div></div>

<p>For <code class="highlighter-rouge">udev</code> to recognize these rules we must create the following file <code class="highlighter-rouge">/etc/udev/rules.d/40-printers.rules</code> , with this content:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> # Genius Pro
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="3594398F3538", SYMLINK="ttyGeniusPro"

# Sidewinder X2
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="386F39543538", SYMLINK="ttySidewinderX2"
</code></pre></div></div>

<p>Then <code class="highlighter-rouge">udev</code> must be restarted to take these changes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm control --reload-rules &amp;&amp; udevadm trigger
</code></pre></div></div>

<p>This way the printers will be mapped as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# ls -l  /dev/tty{GeniusPro,Sidewinder}*
lrwxrwxrwx 1 root root 7 Aug 22 21:10 /dev/ttyGeniusPro -&gt; ttyACM0
lrwxrwxrwx 1 root root 7 Aug 22 21:10 /dev/ttySidewinderX2 -&gt; ttyACM1
</code></pre></div></div>

<p>So the Docker configuration can be modified to reflect these changes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyGeniusPro:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/video0:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30

  sidewinderx2:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5001:5000
      - 8081:8080
    devices:
      - /dev/ttySidewinderX2:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/video2:/dev/video0
    volumes:
      - /root/octoprint/sidewinderx2:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30  

</code></pre></div></div>

<h2 id="webcams">Webcams</h2>

<p>Unlike printers which have different serial numbers, I have two <strong>Logitech C270</strong> webcams that are exactly the same model. How can we  differente them? How can we make the OS to take the right camera?</p>

<p>Again we do the analysis with <code class="highlighter-rouge">lsusb</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# lsusb
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 004: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 003: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 015: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 016: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 002: ID 2109:3431 VIA Labs, Inc. Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre></div></div>

<p>Ambas cámaras están en el mismos bus pero identificadas como dispositivos USB diferentes, lo cual podemos aprovechar. En este caso no usaremos el id del producto para diferencialrlas sino el id de dispositivo USB.  Tomaremos como referecia el subsystem <code class="highlighter-rouge">video4linux</code> en vez de <code class="highlighter-rouge">tty</code>, por lo que estaremos usando <code class="highlighter-rouge">KERNELS</code> en vez de <code class="highlighter-rouge">KERNEL</code> para diferenciar las cámaras. Por ejemplo, para saber en qué dispositivo USB está  la cámara en <code class="highlighter-rouge">/dev/video0</code> podemos ejecutar lo siguiente:</p>

<p>Both cameras are on the same bus but identified as different USB devices, which we can take advantage of. In this case we will not use the product id to differentiate them but the USB device id. We’ll be referencing the <code class="highlighter-rouge">video4linux</code> subsystem instead of <code class="highlighter-rouge">tty</code>, so we’ll be using <code class="highlighter-rouge">KERNELS</code> instead of <code class="highlighter-rouge">KERNEL</code> to differentiate cameras. For example, to find out which USB device the camera in <code class="highlighter-rouge">/dev/video0</code> is on, we can run the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm info -a -p  $(udevadm info -q path -n /dev/video0) | grep KERNELS
    KERNELS=="1-1.4:1.0"
    KERNELS=="1-1.4"
    KERNELS=="1-1"
    KERNELS=="usb1"
    KERNELS=="0000:01:00.0"
    KERNELS=="0000:00:00.0"
    KERNELS=="pci0000:00"
    KERNELS=="fd500000.pcie"
    KERNELS=="scb"
    KERNELS=="platform"
</code></pre></div></div>

<p>For the other camera we do the same:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm info -a -p  $(udevadm info -q path -n /dev/video2) | grep KERNELS
    KERNELS=="1-1.3:1.0"
    KERNELS=="1-1.3"
    KERNELS=="1-1"
    KERNELS=="usb1"
    KERNELS=="0000:01:00.0"
    KERNELS=="0000:00:00.0"
    KERNELS=="pci0000:00"
    KERNELS=="fd500000.pcie"
    KERNELS=="scb"
    KERNELS=="platform"
</code></pre></div></div>

<p>Now with this information we can modify the <code class="highlighter-rouge">udev</code> rules as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Genius Pro
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="3594398F3538", SYMLINK="ttyGeniusPro"
SUBSYSTEM=="video4linux", KERNELS=="1-1.3", ATTRS{idVendor}=="046d", ATTRS{idProduct}=="0825", SYMLINK="videoGeniusPro"

# Sidewinder X2
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="386F39543538", SYMLINK="ttySidewinderX2"
SUBSYSTEM=="video4linux", KERNELS=="1-1.4", ATTRS{idVendor}=="046d", ATTRS{idProduct}=="0825", SYMLINK="videoSidewinderX2"
</code></pre></div></div>

<p>Remember to reset the <code class="highlighter-rouge">udev</code> rules with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm control --reload-rules &amp;&amp; udevadm trigger
</code></pre></div></div>

<p>So now we have the cameras mapped to <code class="highlighter-rouge">/dev/videoGeniusPro</code> and <code class="highlighter-rouge">/dev/videoSidewinderX2</code> respectively. Now we can modify the <strong>docker-compose.yml</strong> file to take this new configuration:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyGeniusPro:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/videoGeniusPro:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30

  sidewinderx2:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5001:5000
      - 8081:8080
    devices:
      - /dev/ttySidewinderX2:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/videoSidewinderX2:/dev/video0
    volumes:
      - /root/octoprint/sidewinderx2:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30
</code></pre></div></div>

<h2 id="performance-with-two-instances-of-octoprint">Performance with two instances of OctoPrint</h2>

<p>Probably you are wondering about the consumption of these containers in the operating system and if the Raspberry can handle it. Here is an image of <code class="highlighter-rouge">htop</code> with the two containers above printing to each of the printers at the same time.</p>

<p><img src="assets/images/octoprint-htop.jpg" alt="Image" /></p>

<p>Como pordás notar la Raspberry está holgada, ya que de los 8GB de RAM apenas está consumiendo 0.5 GB incluyendo el sistema operativo. De esto podemos sacar dos conclusiones: la primera es que se pueden agregar más impresoras sin problemas, el único límite es la cantidad de puertos USB que ofrece las Raspberry (4 en mi modelo), pero podrías agregar un hub USB para agregar puertos; y lo segundo es que para dos impresoras se podría usar una Raspberry con menos RAM, por ejemplo de 2 GB o 4 GB, y así economizarías un poco.</p>

<p>As you can see the Raspberry has a lot of resources available, since of the 8GB of RAM it is only consuming 0.5 GB including the operating system. From this we can draw two conclusions: the first one is that more printers can be added without problems, the only limit is the number of USB ports offered by the Raspberry (4 in my model), but you could add a USB hub to add more ports; and the second conclusion is that for two printers you could use a Raspberry with less RAM, for example 2 GB or 4 GB, and thus you would save a little.</p>

<h2 id="what-does-the-raspberry-pi-and-printers-look-like">What does the Raspberry Pi and printers look like?</h2>

<p>To finish this article I leave you a photo of my printers connected to the RaspBerry Pi:</p>

<p><img src="assets/images/3dprinters.jpg" alt="Image" /></p>

<p>On the smaller printer you can see a small gray box that is the Raspberry Pi, next to the two web cameras.</p>

<h1 id="references">References</h1>
<ul>
  <li><a href="https://octoprint.org" target="_blank">OctoPrint</a></li>
  <li><a href="https://github.com/guysoft/OctoPi" target="_blank">OctoPi</a></li>
  <li><a href="http://thomas-messmer.com/index.php/14-free-knowledge/howtos/79-setting-up-octoprint-for-multiple-printers" target="_blank">Setting up OctoPrint on a Raspberry Pi for multiple printers</a></li>
  <li><a href="https://youtu.be/LcA9o6OGfEg" target="_blank">Installing OctoPrint using Docker in Linux (video tutorial)</a></li>
  <li><a href="https://docs.google.com/document/d/1aU7LGYAe6r45LqEBQ8opuXCiNKeJl3XrPTrobvEvdOM/edit" target="_blank">Installing OctoPrint using Docker in Linux (instructions)</a></li>
  <li><a href="https://community.octoprint.org/t/usb-webcams-known-to-work-with-mjpg-streamer/21149" target="_bla￼nk">USB webcams known to work with mjpg-streamer</a>.</li>
  <li><a href="https://askubuntu.com/questions/49910/how-to-distinguish-between-identical-usb-to-serial-adapters" target="_blank">How to distinguish between identical USB-to-serial adapters?</a></li>
  <li><a href="https://unix.stackexchange.com/questions/424887/udev-rule-to-discern-2-identical-webcams-on-linux">Udev Rule to discern 2 identical webcams on Linux</a>){:target=”_blank”}</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://lgallardo.com/tags/3dprint" class="page__taxonomy-item" rel="tag">3dPrint</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/tags/linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/tags/octopi" class="page__taxonomy-item" rel="tag">OctoPi</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/tags/raspberry" class="page__taxonomy-item" rel="tag">Raspberry</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://lgallardo.com/categories/3dprint" class="page__taxonomy-item" rel="tag">3dPrint</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/categories/linux" class="page__taxonomy-item" rel="tag">Linux</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-09-24T19:00:00-05:00">September 25, 2022</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=lgallard&text=OctoPrint+with+multiple+3D+printers%20https%3A%2F%2Flgallardo.com%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flgallardo.com%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https%3A%2F%2Flgallardo.com%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Flgallardo.com%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://lgallardo.com/2022/04/17/paperlike-pencil-grips" class="pagination--pager" title="PaperLike Pencil Grips
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
    
        <h4 class="page__comments-title">Leave a Comment</h4>
        <section id="disqus_thread"></section>
      
</div>
    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/2022/04/17/paperlike-pencil-grips" rel="permalink">PaperLike Pencil Grips
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  4 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
I’ve been using my iPad for a while to take notes with the Apple Pencil and I decided to write this article to tell you about a product that has pleasantly ...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/2022/01/25/ipad-pro-as-a-portable-workstation/" rel="permalink">iPad Pro as portable workstation
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
It’s been a while since I posted on the blog, first because I couldn’t find something interesting to share and second because there wasn’t much spare time (...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/2021/06/15/helm-local-repo/" rel="permalink">Helm 3 local repo
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
In Helm 3 the support of helm serve command was removed due to some design issues, therefore if you need a similar tool you have to install  helm servecm  p...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/2021/04/15/terraform-module-for-aws-ecr" rel="permalink">Terraform module for AWS ECR
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">

I share here another Terraform module I published as open source code, which allows you to create registries in AWS ECR.

</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/lgallard"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/lgallard"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="https://lgallardo.com/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Luis M. Gallardo D.. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="https://lgallardo.com/assets/js/main.min.js"></script>




  
      
  <script>
    var disqus_config = function () {
      this.page.url = "https://lgallardo.com/2022/09/25/octoprint-multiple-printers";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2022/09/25/octoprint-multiple-printers"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://lgallard.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    



  </body>
</html>
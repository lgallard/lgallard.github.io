<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.6.0 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>OctoPrint con múltiples impresoras 3D - lgallardo.com</title>




<meta name="description" content="Una de las herramientas más útiles a la hora de gestionar una impresora 3D es OctoPrint, ya que entre varias cosas permite administrar tu impresora desde una interfaz web, así como agregar un montón de funcionalidades (por ejemplo, monitoreo y gestión de la impresora a través de Telegram, plugins para generar los videos timelapse de las impresiones, o incluso detectar cuando hay problemas tipo espagueti en nuestra impresiones usando otro plugin con AI).">




<meta name="author" content="Luis Gallardo">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="lgallardo.com">
<meta property="og:title" content="OctoPrint con múltiples impresoras 3D">


  <link rel="canonical" href="https://lgallardo.com/es/2022/09/25/octoprint-multiple-printers">
  <meta property="og:url" content="https://lgallardo.com/es/2022/09/25/octoprint-multiple-printers">



  <meta property="og:description" content="Una de las herramientas más útiles a la hora de gestionar una impresora 3D es OctoPrint, ya que entre varias cosas permite administrar tu impresora desde una interfaz web, así como agregar un montón de funcionalidades (por ejemplo, monitoreo y gestión de la impresora a través de Telegram, plugins para generar los videos timelapse de las impresiones, o incluso detectar cuando hay problemas tipo espagueti en nuestra impresiones usando otro plugin con AI).">



  <meta name="twitter:site" content="@lgallard">
  <meta name="twitter:title" content="OctoPrint con múltiples impresoras 3D">
  <meta name="twitter:description" content="Una de las herramientas más útiles a la hora de gestionar una impresora 3D es OctoPrint, ya que entre varias cosas permite administrar tu impresora desde una interfaz web, así como agregar un montón de funcionalidades (por ejemplo, monitoreo y gestión de la impresora a través de Telegram, plugins para generar los videos timelapse de las impresiones, o incluso detectar cuando hay problemas tipo espagueti en nuestra impresiones usando otro plugin con AI).">
  <meta name="twitter:url" content="https://lgallardo.com/2022/09/25/octoprint-multiple-printers">

  
    <meta name="twitter:card" content="summary">
    
  

  
    <meta name="twitter:creator" content="@Luis Gallardo">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-09-24T19:00:00-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Luis M. Gallardo D.",
      "url" : "https://lgallardo.com/es",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->

<link href="https://lgallardo.com/es/feed.xml" type="application/atom+xml" rel="alternate" title="lgallardo.com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://lgallardo.com/es/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->




    <!-- start custom head snippets -->
<!-- 

  
  <a href="/2022/09/25/octoprint-multiple-printers" >English</a>

-->
<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="https://lgallardo.com/es/">lgallardo.com</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="https://lgallardo.com/es/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://lgallardo.com/es/tags/">Tags</a></li>
          
          
            
            <a href="/2022/09/25/octoprint-multiple-printers" >English</a>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>



    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://lgallardo.com/es/assets/images/luis.jpg" class="author__avatar" alt="Luis M. Gallardo D." itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Luis M. Gallardo D.</h3>
    
      <p class="author__bio" itemprop="description">
        
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Alicante, Spain</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://twitter.com/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      
        <li>
          <a href="https://www.stackoverflow.com/users/3229508/lgallard" itemprop="sameAs">
            <i class="fa fa-fw fa-stack-overflow" aria-hidden="true"></i> Stackoverflow
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="OctoPrint con múltiples impresoras 3D">
    <meta itemprop="description" content="Una de las herramientas más útiles a la hora de gestionar una impresora 3D es OctoPrint, ya que entre varias cosas permite administrar tu impresora desde una interfaz web, así como agregar un montón de funcionalidades (por ejemplo, monitoreo y gestión de la impresora a través de Telegram, plugins para generar los videos timelapse de las impresiones, o incluso detectar cuando hay problemas tipo espagueti en nuestra impresiones usando otro plugin con AI).">
    <meta itemprop="datePublished" content="September 25, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">OctoPrint con múltiples impresoras 3D
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  12 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p><img src="/assets/images/OctoPrint.jpg" alt="OctoPrints" style="display:block; margin-left:auto; margin-right:auto" /><br />
Una de las herramientas más útiles a la hora de gestionar una impresora 3D es <a href="https://octoprint.org" target="_blank">OctoPrint</a>, ya que entre varias cosas permite administrar tu impresora desde una interfaz web, así como agregar un montón de funcionalidades (por ejemplo, monitoreo y gestión de la impresora a través de Telegram, plugins para generar los videos timelapse de las impresiones, o incluso detectar cuando hay problemas tipo espagueti en nuestra impresiones usando otro plugin con AI).</p>

<h2 id="múltiples-impresoras">Múltiples impresoras</h2>
<p>¿Pero qué pasa si tenemos más de una impresora? ¿Puede <strong>OctoPrint</strong> gestionar mas de una impresora?</p>

<p>La respuesta corta es: NO! El software en sí no está diseñado para múltiples impresoras, pero se puede buscar formas alternativas para tener más de una instancia de <strong>OctoPrint</strong> corriendo en nuestro dispositivo o computadora.</p>

<p>Existen varias formas para esto, por ejemplo se puede <a href="http://thomas-messmer.com/index.php/14-free-knowledge/howtos/79-setting-up-octoprint-for-multiple-printers" target="_blank">modificar los scripts de OctoPi para agregar más instancias</a>,  crear scripts que lancen varias instancias del mismo programa , pero la opción que terminé usando  fue la de contenedores Docker.</p>

<h2 id="raspberry-pi--ubuntu">Raspberry Pi + Ubuntu</h2>
<p>En mi caso tengo una <strong>Raspberry Pi 4</strong>, de 8 GB de RAM, más que suficiente para correr múltiples instancias de <strong>OctoPrint</strong>.</p>

<p>En principio tenía instalado en mi Raspberry un sistema operativo específico llamado <a href="https://github.com/guysoft/OctoPi" target="_blank">OctoPi</a>, un derivado de Debian con <strong>OctoPrint</strong> como el programa principal que se lanza cuando se enciende el dispositivo, pero al querer tener contenedores pensé en usar Ubuntu que es una distribución menos especializada y donde seguramente se puede encontrar todo lo necesario para trabajar con contenedores.</p>

<h2 id="requisitos-y-componentes">Requisitos y componentes:</h2>
<p>Para esta configuración usé lo siguiente:</p>

<ul>
  <li>Impresora 3D - Artillery Genius Pro</li>
  <li>Impresora 3D - Artillery SideWinder X2</li>
  <li>2x WebCam - Logitech C270 (una por impresora)</li>
  <li>Raspberry Pi 4 - 8G RAM</li>
  <li>SD Card 64 GB</li>
  <li>Ubuntu 22.04 LTS  ARM 64 bits</li>
  <li>Docker 20.10.17</li>
  <li>OctoPrint lastest (1.8.3)</li>
</ul>

<h2 id="instalación-de-ubuntu">Instalación de Ubuntu</h2>
<p>Para instalar <strong>Ubuntu</strong> en la Raspberry Pi ahora es más sencillo que nunca, solo tienes que descargar <strong>Raspberry Pi Imager,</strong> el cual generará la imagen en tu tarjeta SD, seleccionar el sistema operativo, que en este caso es <strong>Ubuntu 22.04 LTS</strong> y listo. Hay versiones de Raspberry Pi Imager para Linux, Mac y Windows, así que podrás generar la imagen en el sistema operativo que más te convenga.</p>

<p><img src="/assets/images/Raspberry-Pi-Imager.jpg" alt="Raspberry Pi Imager" /></p>

<p>Desde este mismo software vas a tener la posibilidad de configurar la contraseña de la red WiFi en caso de que la estés usando la Raspberry de forma inalámbrica y que no quieras usar un televisor y un teclado (headless), o tocar la SD para configurar la red. Como yo lo estoy usando headless, fue lo que hice y luego me conecté por <strong>ssh</strong>.</p>

<p><img src="/assets/images/OctoPi-WiFi-Setting.jpg" alt="WiFi Settings" /></p>

<p>Para la configuración headless el truco es dejar que corran los scripts de inicialización de <strong>Ubuntu</strong> y luego conectarte por ssh. Ahora si ves que no puedes conectarse por ssh puedes buscar un cable HDMI y un teclado para revisar qué pueda estar pasando.</p>

<h2 id="instalación-del-software-en-ubuntu">Instalación del software en Ubuntu</h2>
<p>Aparte de <strong>Docker</strong> vamos a necesitar, <strong>docker-compose</strong>, y los utilitarios que nos ayudarán a instalarlos.</p>

<h2 id="docker-y-docker-compose">Docker y docker-compose</h2>
<p>Para instalar docker debemos descargarlo usando el script. Necesitaremos entrar como usuario administrador con la cuenta root:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi@octopi:~<span class="nv">$ </span><span class="nb">sudo </span>su
root@octopi:~# 

root@octopi:~# apt install curl
root@octopi:~# curl <span class="nt">-sSL</span> https://get.docker.com | sh

root@octopi:~# apt update
root@octopi:~# apt install docker-compose
</code></pre></div></div>

<h2 id="octoprint-con-una-impresora">OctoPrint con una impresora</h2>
<p>Lo primero que haremos es crear un carpeta para OctoPrint, y luego entrar en ella:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~# mkdir octoprint
root@octopi:~# 
root@octopi:~# <span class="nb">cd </span>octoprint/
root@octopi:~/octoprint#
</code></pre></div></div>

<p>Vamos a empezar con una impresora, en este caso empezaré con la <code class="highlighter-rouge">Artillery Genius Pro</code>.  Para esto creamos una carpeta que identifique a esta impresora:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~# mkdir geniuspro
root@octopi:~# chmod <span class="nt">-R</span> 777 geniuspro/
</code></pre></div></div>

<p>Es importante saber la ruta actual porque luego la usaremos en la definición del contenedor junto con el nombre de esta carpeta. Para ello ejecutamos la siguiente orden:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~# <span class="nb">pwd</span>
/root/octoprint
</code></pre></div></div>

<p>Ya con esto podemos indicar luego que los archivos de esta primera instancia de OctoPrint residirán en <code class="highlighter-rouge">/root/octoprint/geniuspro</code>.</p>

<p>Ahora para configurar la impresora vamos a usar <code class="highlighter-rouge">docker-compose</code> por lo que creamos el archivo <code class="highlighter-rouge">docker-compose.yml</code> con la siguiente información:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyACM0:/dev/ttyACM0
      - /dev/video0:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30
</code></pre></div></div>

<p>Este archivo define varias cosas relacionadas a OctoPrint, como la cámara web y la impresora como tal. Por ejemplo, con <code class="highlighter-rouge">image</code> indicamos cuál es la imagen Docker a usar para el servicio <code class="highlighter-rouge">geniuspro</code>.</p>

<p>En esta definición hay que destacar los puertos, los cuales serán usados para acceder a los servicios, siendo el <code class="highlighter-rouge">5000</code> para la interfaz web y el <code class="highlighter-rouge">8080</code> para el streaming de video de la cámara web.</p>

<p>Por otro lado se define como dispositivo la impresora en <code class="highlighter-rouge">/dev/ttyACM0</code>, y la cámara web en <code class="highlighter-rouge">/dev/video0</code></p>

<p>Algo a tener en cuenta y que se diferencia del <a href="https://docs.google.com/document/d/1aU7LGYAe6r45LqEBQ8opuXCiNKeJl3XrPTrobvEvdOM/edit" target="_bla￼nk">ejemplo en cuál me basé</a>, es que el streamer ahora es parte de la imagen Docker y es atendido en el puerto <code class="highlighter-rouge">8080</code>, por los que no hace falta tener una definición aparte a otra imagen Docker apuntando al streamer.</p>

<p>Luego en <code class="highlighter-rouge">volumes</code> es donde se hace la referencia al directorio de la impresora que habíamos creado en la ruta  <code class="highlighter-rouge">/root/octoprint/geniuspro</code>, que será mapeada  dentro del contenedor en  la carpeta <code class="highlighter-rouge">/octoprint</code>. Es decir, cuando levantemos el contenedor todos los archivos de OctoPrint para esta impresora quedarán en la ruta <code class="highlighter-rouge">/root/octoprint/geniuspro</code> del sistema operativo.</p>

<p>Por último, en <code class="highlighter-rouge">environment</code> definimos los parámetros para el streamer, pasando la información del dispositivo de la cámara web referido desde el contenedor, que en este caso coincide con el del sistema operativo afitrión, es decir, <code class="highlighter-rouge">/dev/video0</code>. También le proporcionamos los parámetros de la cámara, en mi caso le indico que la resolución es de 1280x960 a 30 frames por segundos, que es lo que corresponde com mi Logitech C270. Para otros modelos puedes consultar el <a href="https://community.octoprint.org/t/usb-webcams-known-to-work-with-mjpg-streamer/21149" target="_bla￼nk">listado desde la  página de cámaras soportadas</a>.</p>

<p>Una vez creado el archivo  <code class="highlighter-rouge">docker-compose.yml</code> con la información mostrada arriba, solo basta con levantar el servicio con Docker:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# docker-compose up -d
  
Creating octoprint_geniuspro_1 ... done
</code></pre></div></div>

<p>Ya con esto podemos acceder a la interfaz web de OctoPrint desde la ip de la Raspberry en el puerto que le habíamos indicado, que en mi caso la url es http://192.168.68.102:5000:</p>

<p><img src="/assets/images/octoprint-multi-web.jpg" alt="OctoPrint Web 1" /></p>

<h2 id="agregar-una-segunda-impresora">Agregar una segunda impresora</h2>
<p>Para agregar una segunda impresora solo hay que replicar la configuración que teníamos antes, pero especificando la nueva impresora y la cámara de video correspondiente. Entonces para mi Artillery Sidewinder X2 esto sería:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyACM0:/dev/ttyACM0
      - /dev/video0:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30
 
  sidewinder_x2:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyACM1:/dev/ttyACM0
      - /dev/video2:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30

</code></pre></div></div>

<p>Aquí hay que aclarar que en el apartado devices físicamente la impresora está identificada en la Raspberry como <code class="highlighter-rouge">/dev/ttyACM1</code>, pero al crear el contenedor internamente se identificará como <code class="highlighter-rouge">/dev/ttyACM0</code>. Lo mismo pasa con la cámara de video, donde físicamente se identifca como <code class="highlighter-rouge">/dev/video2</code> pero internamente el contenedor la verá como <code class="highlighter-rouge">/dev/video0</code>.</p>

<p>Una vez creada la configuración se debe levantar el contendor de la siguiente manera:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# docker-compose up -d
  
octoprint_geniuspro_1 is up-to-date
Creating octoprint_sidewinderx2_1 ... done
</code></pre></div></div>

<p>Con esto ya se podrá acceder a la segunda instancia de OctoPrint en el puerto 5001:</p>

<p><img src="/assets/images/octoprint-multi-web2.jpg" alt="OctoPrint Web 2" /></p>

<h2 id="cómo-diferenciar-las-impresoras">¿Cómo diferenciar las impresoras?</h2>
<p>En el anterior ejemplo usé los dipositivos <code class="highlighter-rouge">/dev/ttyACM0</code> y <code class="highlighter-rouge">/dev/ttyACM1</code>  para hacer referencia a mi primera impresora, la Artillery Genius Pro, y a la segunda impresora la Artillery SideWinder X2, pero el sistema operativo no siempre las tomará en ese orden, ya que dependerá de cuál encienda primero . Para poder identificar las impresoras sin importar el orden de conexión podemos crear un enlace simbólico usando <code class="highlighter-rouge">udev</code> con la información del fabricante y del producto.</p>

<p>Para esto primero hay que listar los dispositivos USB:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# lsusb
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 004: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 003: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 015: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 016: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 002: ID 2109:3431 VIA Labs, Inc. Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre></div></div>

<p>Acá hay dos dispositivos de <strong>STMicroelectronics Virtual COM Port</strong>, que corresponden a las dos impresoras, pero cuál es cuál? Vamos a pedir el detalle de estos dispositivos:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@octopi:~/octoprint# lsusb -v -d 0483:5740

Bus 001 Device 015: ID 0483:5740 STMicroelectronics Virtual COM Port
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            2 Communications
  bDeviceSubClass         2 Abstract (modem)
  bDeviceProtocol         0
  bMaxPacketSize0        64
  idVendor           0x0483 STMicroelectronics
  idProduct          0x5740 Virtual COM Port
  bcdDevice            0.00
  iManufacturer           1 STMicroelectronics
  iProduct                2 ARTILLERY_RUBY CDC in FS Mode
  iSerial                 3 386F39543538  
...
  
Bus 001 Device 016: ID 0483:5740 STMicroelectronics Virtual COM Port
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass            2 Communications
  bDeviceSubClass         2 Abstract (modem)
  bDeviceProtocol         0
  bMaxPacketSize0        64
  idVendor           0x0483 STMicroelectronics
  idProduct          0x5740 Virtual COM Port
  bcdDevice            0.00
  iManufacturer           1 STMicroelectronics
  iProduct                2 ARTILLERY_RUBY CDC in FS Mode
  iSerial                 3 3594398F3538  
...
</code></pre></div></div>

<p>Lo que diferenica una impresora de la otra es el número serial del dispositivo. Como inicialmente la Artillery Genius Pro estaba mapeada en <code class="highlighter-rouge">/dev/ttyACM0</code>, podemos consultar cuál es su número de serial:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm info -a -n /dev/ttyACM0 | grep serial
    ATTRS{serial}=="3594398F3538"
    ATTRS{serial}=="0000:01:00.0"
</code></pre></div></div>

<p>Ahora para la ver el código serial de la Artillery Sidewinder X2 se debe consultar por el dispositivo <code class="highlighter-rouge">/dev/ttyACM1</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
root@octopi:~/octoprint# udevadm info -a -n /dev/ttyACM1 | grep serial
    ATTRS{serial}=="386F39543538"
    ATTRS{serial}=="0000:01:00.0" 
</code></pre></div></div>

<p>Para que  <code class="highlighter-rouge">udev</code>  reconozca estas reglas debemos crear el siguiente archivo <code class="highlighter-rouge">/etc/udev/rules.d/40-printers.rules</code> , con este contenido:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> # Genius Pro
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="3594398F3538", SYMLINK="ttyGeniusPro"

# Sidewinder X2
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="386F39543538", SYMLINK="ttySidewinderX2"
</code></pre></div></div>

<p>Luego se debe reiniciar <code class="highlighter-rouge">udev</code> para que tome estos cambios:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm control --reload-rules &amp;&amp; udevadm trigger
</code></pre></div></div>

<p>De esta manera quedarán las impresoras mapeadas de la siguiente forma:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# ls -l  /dev/tty{GeniusPro,Sidewinder}*
lrwxrwxrwx 1 root root 7 Aug 22 21:10 /dev/ttyGeniusPro -&gt; ttyACM0
lrwxrwxrwx 1 root root 7 Aug 22 21:10 /dev/ttySidewinderX2 -&gt; ttyACM1
</code></pre></div></div>

<p>Por lo que la configuración de Docker podemos modificarla para reflejar estos cambios:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyGeniusPro:/dev/ttyACM0
      - /dev/video0:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30

  sidewinderx2:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5001:5000
      - 8081:8080
    devices:
      - /dev/ttySidewinderX2:/dev/ttyACM0
      - /dev/video2:/dev/video0
    volumes:
      - /root/octoprint/sidewinderx2:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30  

</code></pre></div></div>

<h2 id="cámaras-de-video">Cámaras de video</h2>
<p>A diferencia de las impresoras las cuales tienen seriales distintos, tengo dos cámaras de video <strong>Logitech C270</strong> que son exaxtamente iguales. ¿Cómo hacemos para diferenciarlas? ¿Cómo podemos hacer que siempre tome la cámara correcta?</p>

<p>Nuevamente hacemos el análisis con  <code class="highlighter-rouge">lsusb</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# lsusb
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 004: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 003: ID 046d:0825 Logitech, Inc. Webcam C270
Bus 001 Device 015: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 016: ID 0483:5740 STMicroelectronics Virtual COM Port
Bus 001 Device 002: ID 2109:3431 VIA Labs, Inc. Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre></div></div>

<p>Ambas cámaras están en el mismos bus pero identificadas como dispositivos USB diferentes, lo cual podemos aprovechar. En este caso no usaremos el id del producto para diferenciarlas sino el id de dispositivo USB.  Tomaremos como referencia el subsystem <code class="highlighter-rouge">video4linux</code> en vez de <code class="highlighter-rouge">tty</code>, por lo que estaremos usando <code class="highlighter-rouge">KERNELS</code> en vez de <code class="highlighter-rouge">KERNEL</code> para diferenciar las cámaras. Por ejemplo, para saber en qué dispositivo USB está  la cámara en <code class="highlighter-rouge">/dev/video0</code> podemos ejecutar lo siguiente:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm info -a -p  $(udevadm info -q path -n /dev/video0) | grep KERNELS
    KERNELS=="1-1.4:1.0"
    KERNELS=="1-1.4"
    KERNELS=="1-1"
    KERNELS=="usb1"
    KERNELS=="0000:01:00.0"
    KERNELS=="0000:00:00.0"
    KERNELS=="pci0000:00"
    KERNELS=="fd500000.pcie"
    KERNELS=="scb"
    KERNELS=="platform"
</code></pre></div></div>

<p>Para la otra cámara hacemos lo mismo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm info -a -p  $(udevadm info -q path -n /dev/video2) | grep KERNELS
    KERNELS=="1-1.3:1.0"
    KERNELS=="1-1.3"
    KERNELS=="1-1"
    KERNELS=="usb1"
    KERNELS=="0000:01:00.0"
    KERNELS=="0000:00:00.0"
    KERNELS=="pci0000:00"
    KERNELS=="fd500000.pcie"
    KERNELS=="scb"
    KERNELS=="platform"
</code></pre></div></div>

<p>Ya con esta información podemos modificar las reglas de <code class="highlighter-rouge">udev</code> de la siguiente manera:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Genius Pro
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="3594398F3538", SYMLINK="ttyGeniusPro"
SUBSYSTEM=="video4linux", KERNELS=="1-1.3", ATTRS{idVendor}=="046d", ATTRS{idProduct}=="0825", SYMLINK="videoGeniusPro"

# Sidewinder X2
KERNEL=="ttyACM[0-9]*", SUBSYSTEM=="tty", ATTRS{idVendor}=="0483", ATTRS{idProduct}=="5740", ATTRS{serial}=="386F39543538", SYMLINK="ttySidewinderX2"
SUBSYSTEM=="video4linux", KERNELS=="1-1.4", ATTRS{idVendor}=="046d", ATTRS{idProduct}=="0825", SYMLINK="videoSidewinderX2"
</code></pre></div></div>

<p>Recuerden reiniciar las reglas de udev con:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@octopi:~/octoprint# udevadm control --reload-rules &amp;&amp; udevadm trigger
</code></pre></div></div>

<p>De esta forma ahora tenemos las cámaras mapeadas como <code class="highlighter-rouge">/dev/videoGeniusPro</code>y  <code class="highlighter-rouge">/dev/videoSidewinderX2</code> respectivamente. Ahora podemos modificar el archivo <strong>docker-compose.yml</strong> para que tome esta nueva configuración:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2.4'

services:
  geniuspro:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5000:5000
      - 8080:8080
    devices:
      - /dev/ttyGeniusPro:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/videoGeniusPro:/dev/video0
    volumes:
      - /root/octoprint/geniuspro:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30

  sidewinderx2:
    image: octoprint/octoprint
    restart: unless-stopped
    ports:
      - 5001:5000
      - 8081:8080
    devices:
      - /dev/ttySidewinderX2:/dev/ttyACM0 # use `python -m serial.tools.miniterm` to see what the name is of the printer, this requires pyserial
      - /dev/videoSidewinderX2:/dev/video0
    volumes:
      - /root/octoprint/sidewinderx2:/octoprint
    # uncomment the lines below to ensure camera streaming is enabled when
    # you add a video device
    environment:
      - ENABLE_MJPG_STREAMER=true
      - CAMERA_DEV=/dev/video0
      - MJPG_STREAMER_INPUT="-y -n -r 1280x960 -f 30
</code></pre></div></div>

<h2 id="desempeño-con-dos-instancias-de-octoprint">Desempeño con dos instancias de OctoPrint</h2>
<p>Seguramente te estarás preguntando sobre el consumo de estos contenedores en el sistema operativo y si las Raspberry puede manejarlo. Aquí te dejo una imagen de <code class="highlighter-rouge">htop</code> con los dos contenedores arriba imprimiendo en cada una de las impresoras a la vez.</p>

<p><img src="/assets/images/octoprint-htop.jpg" alt="htop" /></p>

<p>Como pordás notar la Raspberry está holgada, ya que de los 8GB de RAM apenas está consumiendo 0.5 GB incluyendo el sistema operativo. De esto podemos sacar dos conclusiones: la primera es que se pueden agregar más impresoras sin problemas, el único límite es la cantidad de puertos USB que ofrece las Raspberry (4 en mi modelo), pero podrías agregar un hub USB para agregar puertos; y lo segundo es que para dos impresoras se podría usar una Raspberry con menos RAM, por ejemplo de 2 GB o 4 GB, y así economizar un poco.</p>

<h2 id="cómo-luce-las-impresoras-y-la-raspberry-pi">¿Cómo luce las impresoras y la Raspberry Pi?</h2>

<p>Para cerrar este artículo les dejo una foto de mis impresoras conectadas a la RaspBerry Pi:</p>

<p><img src="/assets/images/3dprinters.jpg" alt="3D printers" /></p>

<p>En la impresora más chica puede verse una caja pequeña gris que es la Raspberry Pi, junto a las dos cámaras web.</p>

<h1 id="referencias">Referencias</h1>
<ul>
  <li><a href="https://octoprint.org" target="_blank">OctoPrint</a></li>
  <li><a href="https://github.com/guysoft/OctoPi" target="_blank">OctoPi</a></li>
  <li><a href="http://thomas-messmer.com/index.php/14-free-knowledge/howtos/79-setting-up-octoprint-for-multiple-printers" target="_blank">Setting up OctoPrint on a Raspberry Pi for multiple printers</a></li>
  <li><a href="https://youtu.be/LcA9o6OGfEg" target="_blank">Installing OctoPrint using Docker in Linux (video tutorial)</a></li>
  <li><a href="https://docs.google.com/document/d/1aU7LGYAe6r45LqEBQ8opuXCiNKeJl3XrPTrobvEvdOM/edit" target="_blank">Installing OctoPrint using Docker in Linux (instructions)</a></li>
  <li><a href="https://community.octoprint.org/t/usb-webcams-known-to-work-with-mjpg-streamer/21149" target="_bla￼nk">USB webcams known to work with mjpg-streamer</a>.</li>
  <li><a href="https://askubuntu.com/questions/49910/how-to-distinguish-between-identical-usb-to-serial-adapters" target="_blank">How to distinguish between identical USB-to-serial adapters?</a></li>
  <li><a href="https://unix.stackexchange.com/questions/424887/udev-rule-to-discern-2-identical-webcams-on-linux" target="_blank">Udev Rule to discern 2 identical webcams on Linux</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://lgallardo.com/es/tags/3dprint" class="page__taxonomy-item" rel="tag">3dPrint</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/es/tags/linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/es/tags/octopi" class="page__taxonomy-item" rel="tag">OctoPi</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/es/tags/raspberry" class="page__taxonomy-item" rel="tag">Raspberry</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://lgallardo.com/es/categories/3dprint" class="page__taxonomy-item" rel="tag">3dPrint</a><span class="sep">, </span>
    
      
      
      <a href="https://lgallardo.com/es/categories/linux" class="page__taxonomy-item" rel="tag">Linux</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-09-24T19:00:00-05:00">September 25, 2022</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=lgallard&text=OctoPrint+con+m%C3%BAltiples+impresoras+3D%20https%3A%2F%2Flgallardo.com%2Fes%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flgallardo.com%2Fes%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https%3A%2F%2Flgallardo.com%2Fes%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Flgallardo.com%2Fes%2F2022%2F09%2F25%2Foctoprint-multiple-printers" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://lgallardo.com/es/2022/04/17/paperlike-pencil-grips" class="pagination--pager" title="PaperLike Pencil Grips
">Previous</a>
    
    
      <a href="https://lgallardo.com/es/2023/12/18/aws-recertified-solutions-architect-professional/" class="pagination--pager" title="AWS (re)Certified Solutions Architect - Professional
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
    
        <h4 class="page__comments-title">Leave a Comment</h4>
        <section id="disqus_thread"></section>
      
</div>
    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/es/2024/05/27/batocera-iphone-hotspot/" rel="permalink">Batocera &amp; iPhone hotspot
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
En mi post anterior, mencioné que estoy usando la consola portátil Ambernic 35xxh para retrogaming. Este dispositivo ofrece un formato agradable, horizontal...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/es/2024/05/12/anbernic-35xxh-batocera/" rel="permalink">Anbernic 35xxH and Batocera
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
Hoy en día, el mercado está inundado de una variedad de dispositivos portátiles para la emulación retro, provenientes de varias compañías chinas como Retroi...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/es/2023/12/18/aws-recertified-solutions-architect-professional/" rel="permalink">AWS (re)Certified Solutions Architect - Professional
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
Este artículo es para comentar mi experiecia con el examen para AWS Certified Solutions Architect - Professional (recertificación):

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://lgallardo.com/es/2022/04/17/paperlike-pencil-grips" rel="permalink">PaperLike Pencil Grips
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">
Vengo usando ya desde hace un tiempo mi iPad para tomar notas con el Apple Pencil y decidí escribir este artículo para comentarles sobre un producto que me ...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/lgallard"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/lgallard"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="https://lgallardo.com/es/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Luis M. Gallardo D.. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="https://lgallardo.com/es/assets/js/main.min.js"></script>




  
      
  <script>
    var disqus_config = function () {
      this.page.url = "https://lgallardo.com/es/2022/09/25/octoprint-multiple-printers";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2022/09/25/octoprint-multiple-printers"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://lgallard.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    



  </body>
</html>